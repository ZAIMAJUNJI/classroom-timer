<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <link rel="manifest" href="manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆæ¥­ã‚¿ã‚¤ãƒãƒ¼</title>
  <style>
    body { font-family: sans-serif; padding: 20px; text-align: center; }
    h1 { font-size: 24px; margin-bottom: 20px; }
    .button { padding: 20px; font-size: 18px; margin: 10px auto; width: 90%; max-width: 400px; border-radius: 12px; border: none; color: white; display: block; }
    .btn0 { background: orange; }
    .btn1 { background: forestgreen; }
    .btn2 { background: blueviolet; }
    .btn3 { background: gray; }
    .active { border: 4px solid black; }
    .summary, .history { margin-top: 30px; font-size: 16px; text-align: left; white-space: pre-wrap; max-width: 600px; margin-left: auto; margin-right: auto; }
    button.control { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>æˆæ¥­ã‚¿ã‚¤ãƒãƒ¼</h1>
  <div id="buttons"></div>
  <div class="summary">
    <p>åˆè¨ˆæ™‚é–“ï¼š<span id="totalTime">0:00</span></p>
    <div id="details"></div>
    <button class="control" onclick="saveRecord()">è¨˜éŒ²ã™ã‚‹</button>
    <button class="control" onclick="clearHistory()">è¨˜éŒ²ã‚’ã™ã¹ã¦æ¶ˆã™</button>
  </div>
  <div class="history">
    <h2>è¨˜éŒ²å±¥æ­´</h2>
    <div id="historyLog"></div>
  </div>
  <script>
    if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
    const labels = ["èª¬æ˜ãƒ»ç™ºå•ãƒ»æŒ‡ç¤º", "æ´»å‹•", "ã‚ã„ã¾ã„", "ãã®ä»–"];
    let times = [0, 0, 0, 0];
    let active = null;
    let lastTime = null;

    function format(ms) {
      const s = Math.floor(ms / 1000);
      const m = Math.floor(s / 60);
      return `${m}:${(s % 60).toString().padStart(2, '0')}`;
    }

    function render() {
      const total = times.reduce((a, b) => a + b, 0);
      document.getElementById('totalTime').textContent = format(total);
      const d = document.getElementById('details');
      d.innerHTML = labels.map((l, i) => {
        const pct = total ? ((times[i] / total) * 100).toFixed(1) : 0;
        return `${l}ï¼š${format(times[i])}ï¼ˆ${pct}%ï¼‰`;
      }).join('\n');
    }

    function update() {
      if (active !== null) {
        const now = Date.now();
        times[active] += now - lastTime;
        lastTime = now;
        render();
      }
    }

    setInterval(update, 1000);

    const container = document.getElementById('buttons');
    labels.forEach((l, i) => {
      const btn = document.createElement('button');
      btn.textContent = l;
      btn.className = `button btn${i}`;
      btn.onclick = () => {
        document.querySelectorAll('.button').forEach(b => b.classList.remove('active'));
        if (active === i) {
          active = null;
        } else {
          active = i;
          lastTime = Date.now();
          btn.classList.add('active');
        }
      };
      container.appendChild(btn);
    });

function saveRecord() {
  const now = new Date();
  const dateStr = now.toLocaleDateString();
  const timeStr = now.toLocaleTimeString();
  const total = times.reduce((a, b) => a + b, 0);
  const lines = labels.map((l, i) => {
    const pct = total ? ((times[i] / total) * 100).toFixed(1) : 0;
    return `${l}ï¼š${format(times[i])}ï¼ˆ${pct}%ï¼‰`;
  });

  const record = {
    timestamp: `${dateStr} ${timeStr}`,
    lines: lines,
    locked: false
  };

  const history = JSON.parse(localStorage.getItem('history') || '[]');
  history.unshift(record);
  localStorage.setItem('history', JSON.stringify(history));
  loadHistory();
    }

function loadHistory() {
  const history = JSON.parse(localStorage.getItem('history') || '[]');
  const log = document.getElementById('historyLog');
  log.innerHTML = "";

  history.forEach((item, index) => {
    const div = document.createElement("div");
    div.style.border = "1px solid #ccc";
    div.style.padding = "10px";
    div.style.marginBottom = "10px";
    div.style.backgroundColor = item.locked ? "#eee" : "#fff";

    div.innerHTML = `<strong>${item.timestamp}</strong><br>${item.lines.join('<br>')}<br>`;

    const lockBtn = document.createElement("button");
    lockBtn.textContent = item.locked ? "ğŸ”’ ãƒ­ãƒƒã‚¯ä¸­" : "ğŸ”“ ãƒ­ãƒƒã‚¯";
    lockBtn.onclick = () => {
      item.locked = !item.locked;
      localStorage.setItem('history', JSON.stringify(history));
      loadHistory();
    };

    div.appendChild(lockBtn);
    log.appendChild(div);
  });
}
function clearHistory() {
  const history = JSON.parse(localStorage.getItem('history') || '[]');
  const kept = history.filter(item => item.locked);
  localStorage.setItem('history', JSON.stringify(kept));
  loadHistory();
}

    loadHistory();
    render();
</script>

<!-- ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦OKï¼ -->
<!-- â„¹ï¸ æƒ…å ±ãƒœã‚¿ãƒ³ -->
<button onclick="document.getElementById('infoModal').style.display='block'" style="position:fixed; bottom:20px; right:20px; font-size:1.2em;">â„¹ï¸</button>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«å†…å®¹ -->
<div id="infoModal" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.3); max-width:90%; width:400px; z-index:999; text-align:left; overflow-y:auto; max-height:80vh;">
  <h2 style="margin-top:0; text-align:center;">ã“ã®ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦</h2>
<ul style="padding-left: 1.2em; font-size: 15px;">
  <li>æˆæ¥­ä¸­ã®æ´»å‹•æ™‚é–“ã‚’ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«è¨ˆæ¸¬ãƒ»è¨˜éŒ²ã§ãã¾ã™ã€‚</li>
  <li>è¨˜éŒ²ã¯ã€Œè¨˜éŒ²ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã§ä¿å­˜ã•ã‚Œã¾ã™ã€‚</li>
  <li>è¨˜éŒ²ã”ã¨ã«ã€ŒğŸ”“ ãƒ­ãƒƒã‚¯ã€ãƒœã‚¿ãƒ³ã§ä¿è­·ã§ãã¾ã™ã€‚</li>
  <li>ãƒ­ãƒƒã‚¯ä¸­ã¯ã€Œè¨˜éŒ²ã‚’ã™ã¹ã¦æ¶ˆã™ã€ã‚’æŠ¼ã—ã¦ã‚‚æ¶ˆãˆã¾ã›ã‚“ã€‚</li>
  <li>ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚å‹•ä½œã—ã€ã‚¹ãƒãƒ›ã®ãƒ›ãƒ¼ãƒ ã«è¿½åŠ ã—ã¦ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¾ã™ã€‚</li>
  <li>è‘—ä½œæ¨©ã¯åˆ¶ä½œè€…ã«å¸°å±ã—ã¾ã™ã€‚</li>
  <li>åˆ©ç”¨ã¯ã”è‡ªèº«ã®è²¬ä»»ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚</li>
</ul>
  <div style="text-align:right; margin-top:10px;">
    <button onclick="document.getElementById('infoModal').style.display='none'" style="padding:5px 10px;">é–‰ã˜ã‚‹</button>
  </div>
</div>

</body>
</html>
</body>
</html>
